version: 1

project:
  name: AgentRail
  description: "Stack-agnostic agentic development framework repository"

workflow:
  task_root: "work"
  docs_root: "docs"
  strict_blocking: true

commands:
  build:
    description: "Project-specific build command"
    command: >-
      pwsh -NoProfile -Command "Write-Output 'Build step: documentation-only repository, no binary build required.'"
  test:
    description: "Project-specific test command"
    command: >-
      pwsh -NoProfile -Command '$required = @("AGENTS.md","CLAUDE.md","MEMORY.md","project.profile.yaml","docs/INDEX.md"); $missing = $required | Where-Object { -not (Test-Path $_) }; if ($missing.Count -gt 0) { Write-Error ("Missing files: " + ($missing -join ", ")); exit 1 }; Write-Output "Baseline framework file check passed."'
  format:
    description: "Project-specific format command"
    command: >-
      pwsh -NoProfile -Command "Write-Output 'Format step: markdown formatting is manual in this repository.'"
  lint:
    description: "Project-specific lint command"
    command: >-
      pwsh -NoProfile -Command "Write-Output 'Lint step: policy checks are performed via review checklist.'"
  index_docs:
    description: "Rebuild managed sections in docs/INDEX.md"
    command: "pwsh -NoProfile -File tools/docs-indexer/index.ps1"
  check_consistency:
    description: "Run consistency checks for a task"
    command: "pwsh -NoProfile -File tools/consistency-check/check.ps1 -TaskId <task-id>"
  scan_improvements:
    description: "Validate and extract process findings from review.md"
    command: "pwsh -NoProfile -File tools/improvement-harvest/scan.ps1 -TaskId <task-id>"
  create_improvement_task:
    description: "Create a follow-up task from process finding"
    command: "pwsh -NoProfile -File tools/improvement-harvest/create-task.ps1 -SourceTaskId <task-id> -FindingId <finding-id> -Title <title> -Severity <severity> -Category <category>"

paths:
  source_roots:
    - "agents"
    - "docs"
    - "work"
  artifacts:
    - "work"
    - "docs"

review:
  required_checks:
    - id: "spec_required_sections_filled"
      description: "spec.md の空欄禁止項目が埋まっている"
    - id: "test_requirements_defined"
      description: "テスト要件が実施可能な粒度で定義されている"
    - id: "plan_references_spec"
      description: "plan.md が spec.md を参照している"
    - id: "docs_index_updated"
      description: "docs/INDEX.md が更新されている"
    - id: "improvement_findings_present"
      description: "review.md に Process Findings が定義されている"
    - id: "improvement_task_linked"
      description: "action_required=yes の finding が linked_task_id を持つ"
    - id: "improvement_threshold_enforced"
      description: "must/high finding が必ず改善タスクへ接続されている"

defaults:
  documentation_language: "ja"
  code_comment_language: "en"
